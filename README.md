# cpp-tictactoe

Realisation of unwinnable Tic-Tac-Toe game in c++. The program uses bruteforce method to find the best moves for an AI. The whole training process takes less than 30ms!

# Installation

To compile ttt.cpp on Linux, use one of those commands:

```g++ ttt.cpp -o ttt -O3 -s```
or
```clang++ ttt.cpp -o ttt -O3 -s```

Note: For some reason multi-threaded approach on Lubuntu works 5 times slower than single-threaded one for me, to get the program running in a single-threaded mode, simply replace:
```
thread th1(calcfir, addtwo, optirand);
thread th2(calcsec, addtwo, optirand);
th1.join();
th2.join();
```
lines to:
```
calcfir(addtwo, optirand);
calcsec(addtwo, optirand);
```
Which would effectively run it in a single threaded mode.

To get Windows version, go to the release tab and download one of the files (ttt.cpp or tttc.cpp). If you want to compile it on Windows, setup MSYS2 environment and add your compiler to the PATH, then locate your file in cmd and enter this command: ```g++ ttt.cpp -o ttt -O3 -s```

# Usage

To submit a move to an AI enter 1-9 on your keyboard. To run a 2mil AI benchmark to double check that it is actually unwinnable, use ```./ttt check``` command. To regenerate memory.glx file, use ```./ttt rebuild``` command. To do both things at once, use ```./ttt both``` command.
Memory.glx file is a simple text file to dump Ai moves to, dont confuse with a graphics file. I use cusom extension for it to hide it from Notepad, especially on Windows.

# Features

This program features a highly optimized bruteforce algorithm, as well as O complexity for an AI move generator. 
How does it work?

Firstly, the program generates ```int8_t posopti[][]``` and ```int8_t winarr[]``` arrays. The first array generates all possible moves for a given state, while the second one checks for a winning condition on a specific position.
```checkWin()``` function uses highly optimized bitset method.
The position encoding is a simple power-3-based scheme, starting from the bottom left corner as 3^0. Highest position number is practially 18913, so the program uses this number to save some RAM. Total RAM usage is around 340kb.
The posopti array functions differently: the first dimension is dedicated to a special code, while the second dimension serves the following purpose: the first 0-8 elements represent possible positions, the 9th element indicates the actual count of possible positions, and the 10th element serves as a special flag.
The sppecial code works like that: it is power-3-based encoded, and corresponds to some number like: ```1(the special flag)000101110```. The number count after the special flag is always 9 and those numbers correspond to possible moves in a current position.
If the special flag is set to 2, it indicates that all other options are to be ignored, and the AI will always choose this particular option. Consequently, in this scenario, Optipos only stores the first '2'. In a valid position, only one occurrence of '2' is allowed in its 3-decimal equivalent, making any number with more than one '2' illegitimate. 
This condition implies the presence of either a forced win in two moves, the best move, or a winning move.
There are also power3 and power3double arrays, to make power3 based calculations as fast as possible.
The ```short pr[]``` array defines AI logic. It is being used as a special code to input into optipos array. It is initialized with all the possible moves in a position encoded in a power-3-based scheme.
The ```int8_t optiarr[]```s are being used for storing position into 3-decimal variant to speed up the calculations.
```short optirand[]``` is being used for a "dummy" AI to train the main AI.
And finally, the ```int8_t addtwo``` array is utilized by the AI to plan two moves in advance, enhancing it's ability to make strategic decisions and improve its chances of winning.

Also, there is a funny feature which i call "player mocking". Every time AI wins, it displays one of the 10 phrases generated by chatGPT. There is also a ```bool EXTRACOCKY``` variable at the top of the program to display extra 2 phrases when the player loses/draws a game.
The ```tttc.exe``` has this flag turned on, while ```ttt.exe``` has it off.

If you are creating a clever AI with caching, you can probably use one of the optimizations above to speed everything up.


